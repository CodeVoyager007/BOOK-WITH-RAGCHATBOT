"use strict";(globalThis.webpackChunksentient_machines_handbook=globalThis.webpackChunksentient_machines_handbook||[]).push([[208],{6024:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"ros2/python-agents","title":"Python Agents: Writing Controllers with `rclpy`","description":"Python is an incredibly popular language in robotics due to its readability, extensive libraries, and rapid prototyping capabilities. rclpy is the official Python client library for ROS 2, providing a full-featured API to interact with the ROS graph.","source":"@site/docs/02-ros2/04-python-agents.md","sourceDirName":"02-ros2","slug":"/ros2/python-agents","permalink":"/BOOK-WITH-RAGCHATBOT/docs/ros2/python-agents","draft":false,"unlisted":false,"editUrl":"https://github.com/CodeVoyager007/BOOK-WITH-RAGCHATBOT/tree/main/book/docs/02-ros2/04-python-agents.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Python Agents: Writing Controllers with `rclpy`","sidebar_label":"Python Agents"},"sidebar":"tutorialSidebar","previous":{"title":"Services & Actions","permalink":"/BOOK-WITH-RAGCHATBOT/docs/ros2/services-actions"},"next":{"title":"Launch Systems","permalink":"/BOOK-WITH-RAGCHATBOT/docs/ros2/launch-systems"}}');var t=s(4848),r=s(8453);const i={title:"Python Agents: Writing Controllers with `rclpy`",sidebar_label:"Python Agents"},l="Python Agents: Writing Controllers with rclpy",c={},a=[{value:"Building Blocks of an <code>rclpy</code> Node",id:"building-blocks-of-an-rclpy-node",level:2},{value:"Example: A Simple Differential Drive Controller",id:"example-a-simple-differential-drive-controller",level:2},{value:"<code>robot_controller.py</code>",id:"robot_controllerpy",level:3},{value:"<code>obstacle_sensor_simulator.py</code>",id:"obstacle_sensor_simulatorpy",level:3},{value:"Running the Agents",id:"running-the-agents",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsxs)(n.h1,{id:"python-agents-writing-controllers-with-rclpy",children:["Python Agents: Writing Controllers with ",(0,t.jsx)(n.code,{children:"rclpy"})]})}),"\n",(0,t.jsxs)(n.p,{children:["Python is an incredibly popular language in robotics due to its readability, extensive libraries, and rapid prototyping capabilities. ",(0,t.jsx)(n.code,{children:"rclpy"})," is the official Python client library for ROS 2, providing a full-featured API to interact with the ROS graph."]}),"\n",(0,t.jsx)(n.p,{children:'In this chapter, we will delve into writing functional ROS 2 nodes in Python, specifically focusing on how to create simple controllers or "agents" that can perceive (via subscriptions) and act (via publications) within the ROS ecosystem.'}),"\n",(0,t.jsxs)(n.h2,{id:"building-blocks-of-an-rclpy-node",children:["Building Blocks of an ",(0,t.jsx)(n.code,{children:"rclpy"})," Node"]}),"\n",(0,t.jsxs)(n.p,{children:["Every ",(0,t.jsx)(n.code,{children:"rclpy"})," node typically involves:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Importing ",(0,t.jsx)(n.code,{children:"rclpy"})," and ",(0,t.jsx)(n.code,{children:"Node"})]}),": The fundamental components."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Importing Message Types"}),": To handle data for topics, services, or actions."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Creating a Class that Inherits from ",(0,t.jsx)(n.code,{children:"Node"})]}),": Encapsulates your node's logic."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"__init__"})," Method"]}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"super().__init__('node_name')"})," to initialize the base Node class."]}),"\n",(0,t.jsx)(n.li,{children:"Creates publishers, subscribers, services, clients, or action clients/servers."}),"\n",(0,t.jsx)(n.li,{children:"Initializes timers for periodic tasks."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Callback Functions"}),": Methods that are executed when new messages arrive on subscribed topics, service requests are received, or timer events occur."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"main"})," Function"]}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"rclpy.init(args=args)"})," to initialize the ROS context."]}),"\n",(0,t.jsxs)(n.li,{children:["Instantiates your ",(0,t.jsx)(n.code,{children:"Node"})," class."]}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"rclpy.spin(node)"})," to keep the node alive and processing events."]}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"node.destroy_node()"})," and ",(0,t.jsx)(n.code,{children:"rclpy.shutdown()"})," upon exit."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-a-simple-differential-drive-controller",children:"Example: A Simple Differential Drive Controller"}),"\n",(0,t.jsxs)(n.p,{children:['Let\'s imagine a robot that needs to move forward until it "sees" something, then stop. We can simulate this with a controller node that publishes ',(0,t.jsx)(n.code,{children:"Twist"}),' messages (movement commands) and subscribes to a simulated "obstacle detected" message (a simple boolean).']}),"\n",(0,t.jsx)(n.h3,{id:"robot_controllerpy",children:(0,t.jsx)(n.code,{children:"robot_controller.py"})}),"\n",(0,t.jsxs)(n.p,{children:["This node will publish ",(0,t.jsx)(n.code,{children:"Twist"})," messages to control the robot's linear and angular velocity. It will stop if it receives a ",(0,t.jsx)(n.code,{children:"True"})," message on the ",(0,t.jsx)(n.code,{children:"/obstacle_detected"})," topic."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom std_msgs.msg import Bool # For simulating obstacle detection\n\nclass RobotController(Node):\n\n    def __init__(self):\n        super().__init__('robot_controller')\n        # Publisher for movement commands\n        self.publisher_ = self.create_publisher(Twist, '/cmd_vel', 10)\n        # Subscriber for obstacle detection\n        self.subscriber_ = self.create_subscription(\n            Bool,\n            '/obstacle_detected',\n            self.obstacle_callback,\n            10)\n        self.subscriber_ # prevent unused variable warning\n        \n        self.is_moving = True\n        timer_period = 0.1 # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.get_logger().info(\"Robot Controller node started. Moving forward...\")\n\n    def obstacle_callback(self, msg):\n        if msg.data is True and self.is_moving:\n            self.get_logger().info(\"Obstacle detected! Stopping robot.\")\n            self.stop_robot()\n        elif msg.data is False and not self.is_moving:\n            self.get_logger().info(\"Path clear! Resuming movement.\")\n            self.start_robot()\n\n    def timer_callback(self):\n        if self.is_moving:\n            msg = Twist()\n            msg.linear.x = 0.2 # Move forward at 0.2 m/s\n            msg.angular.z = 0.0 # Don't turn\n            self.publisher_.publish(msg)\n            self.get_logger().debug(f'Publishing: Linear X: {msg.linear.x}')\n\n    def stop_robot(self):\n        if self.is_moving:\n            stop_msg = Twist() # All zeros\n            self.publisher_.publish(stop_msg)\n            self.is_moving = False\n\n    def start_robot(self):\n        if not self.is_moving:\n            self.is_moving = True\n\ndef main(args=None):\n    rclpy.init(args=args)\n    robot_controller = RobotController()\n    rclpy.spin(robot_controller)\n    robot_controller.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsx)(n.h3,{id:"obstacle_sensor_simulatorpy",children:(0,t.jsx)(n.code,{children:"obstacle_sensor_simulator.py"})}),"\n",(0,t.jsxs)(n.p,{children:["This node simulates a sensor that detects obstacles. It will publish ",(0,t.jsx)(n.code,{children:"True"})," for a few seconds, then ",(0,t.jsx)(n.code,{children:"False"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Bool\nimport time\n\nclass ObstacleSensorSimulator(Node):\n\n    def __init__(self):\n        super().__init__('obstacle_sensor_simulator')\n        self.publisher_ = self.create_publisher(Bool, '/obstacle_detected', 10)\n        self.timer = self.create_timer(1.0, self.timer_callback) # Publish every second\n        self.obstacle_present = False\n        self.count = 0\n        self.get_logger().info(\"Obstacle Sensor Simulator started.\")\n\n    def timer_callback(self):\n        msg = Bool()\n        if self.count < 5: # Simulate obstacle for 5 seconds\n            msg.data = True\n            self.obstacle_present = True\n        else:\n            msg.data = False\n            self.obstacle_present = False\n            \n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing obstacle_detected: {msg.data}')\n        self.count += 1\n        \n        # Reset after a while to make it repeat\n        if self.count > 10: \n            self.count = 0\n\ndef main(args=None):\n    rclpy.init(args=args)\n    sensor_simulator = ObstacleSensorSimulator()\n    rclpy.spin(sensor_simulator)\n    sensor_simulator.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsx)(n.h2,{id:"running-the-agents",children:"Running the Agents"}),"\n",(0,t.jsx)(n.p,{children:"To run these two nodes, you would typically open two separate terminals in your ROS 2 workspace (after sourcing your setup file) and run each node:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Terminal 1 (Robot Controller):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 robot_controller.py\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Terminal 2 (Obstacle Sensor Simulator):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 obstacle_sensor_simulator.py\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You would observe the ",(0,t.jsx)(n.code,{children:"robot_controller"})," starting to move, stopping when the ",(0,t.jsx)(n.code,{children:"obstacle_sensor_simulator"})," publishes ",(0,t.jsx)(n.code,{children:"True"}),", and resuming when it publishes ",(0,t.jsx)(n.code,{children:"False"}),". This demonstrates the power of ",(0,t.jsx)(n.code,{children:"rclpy"})," to build reactive and modular robotic behaviors."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var o=s(6540);const t={},r=o.createContext(t);function i(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);